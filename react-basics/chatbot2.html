<!DOCTYPE html>
<html>
<head>
    <title>Chatbot</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin-top: 0;
            margin-bottom: 0;
        }
        .send-btn {
            border-radius: 10px;
            border: none;
            padding: 12px 20px;
            margin-left: 10px;
            outline: none;
            cursor: pointer;
            background: none;
            background-color: rgb(25, 135, 84);
            color: white;
            font-size: 15px;
        }

        .chat-input {
            border-radius: 10px;
            border: black solid 1px;
            padding: 12px 20px;
            outline: none;
            cursor: pointer;
            background: none;
            font-size: 15px;

            flex-grow: 1;
        }

        .chat-input-container {
            display: flex;
            margin-bottom: 60px;
        }

        .app-container {
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;

            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .chat-message-user {
            display: flex;
            justify-content: end;
            align-items: start;
        }

        .chat-message-robot {
            display: flex;
            align-items: start;
        }

        .chat-message-text {
            background-color: rgb(238, 238, 238);
            border-radius: 10px;
            padding: 15px 20px;
            margin-left: 10px;
            margin-right: 10px;
            margin-bottom: 20px;
            max-width: 300px;
        }

        .chat-message-profile {
            width: 45px;
        }

        .chat-messages-container {
            flex-grow: 1;
            margin-top: 20px;
            overflow: scroll;
            scrollbar-width: none;
        }

    </style>
</head>
<body>
<div class="js-container"></div>

<script src="https://unpkg.com/supersimpledev/react.js"></script>
<script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
<script src="https://unpkg.com/supersimpledev/babel.js"></script>
<script src="https://unpkg.com/supersimpledev/dayjs.js"></script>
<script src="https://unpkg.com/supersimpledev/chatbot.js"></script>


<script type="text/babel">

    function ChatInput({ chatMessage, setChatMessages }) {
        const [inputText, setInputText] = React.useState('');

        function saveInputText(event) {
            setInputText(event.target.value);
        }

        function sendMessage() {
            const newChatMessage = [
                ...chatMessage,
                {
                    message: inputText,
                    sender: 'user',
                    id: crypto.randomUUID()
                }
            ]

            setChatMessages(newChatMessage);

            const response = Chatbot.getResponse(inputText)

            setChatMessages([
                ...newChatMessage,
                {
                    message: response,
                    sender: 'robot',
                    id: crypto.randomUUID()
                }
            ]);

            setInputText(''); // по желание – да чисти полето
        }

        return (
            <div className="chat-input-container">
                <input
                    className="chat-input"
                    placeholder="Send a message to Chatbot"
                    size="25"
                    value={inputText}
                    onChange={saveInputText}
                />

                <button onClick={sendMessage} className="send-btn">Send</button>
            </div>
        );
    }

    function ChatMessage({ message, sender }) {
        return (
            <div className={sender === 'user' ? 'chat-message-user' : 'chat-message-robot'}>
                {sender === 'robot' && (
                    <img className="chat-message-profile" src="robot.png" />
                )}
                <div className="chat-message-text">
                    {message}
                </div>
                {sender === 'user' && (
                    <img className="chat-message-profile" src="user.png" />
                )}
            </div>
        );
    }

    function ChatMessages({ chatMessage }) {
        const chatMessagesRef = React.useRef(null)

        React.useEffect(() => {
            const containerEl = chatMessagesRef.current
            if (containerEl) {
                containerEl.scrollTop = containerEl.scrollHeight;
            }
        }, [chatMessage]);

        return (
            <div className="chat-messages-container" ref={chatMessagesRef}>
                {chatMessage.map((m) => (
                    <ChatMessage
                        key={m.id}
                        message={m.message}
                        sender={m.sender}
                    />
                ))}
            </div>
        );
    }

    function App() {
        const [chatMessage, setChatMessages] = React.useState([
            { message: 'Hello Chatbot!', sender: 'user',   id: 'id1' },
            { message: 'Hello! how can I help you?', sender: 'robot', id: 'id2' },
            { message: 'Can you get me the date?', sender: 'user',    id: 'id3' },
            { message: 'Have a look at the top of this chat.', sender: 'robot', id: 'id4' }
        ]);

        // състояние за часовника
        const [now, setNow] = React.useState(dayjs());

        React.useEffect(() => {
            const id = setInterval(() => {
                setNow(dayjs());
            }, 1000);

            return () => clearInterval(id);
        }, []);

        const date = now.format('YYYY-MM-DD');
        const time = now.format('HH:mm:ss');

        return (
            <div className="app-container">
                <p>Date: {date}</p>
                <p>Time: {time}</p>

                <ChatMessages chatMessage={chatMessage} />

                <ChatInput
                    chatMessage={chatMessage}
                    setChatMessages={setChatMessages}
                />
            </div>
        );
    }

    const container = document.querySelector('.js-container');
    const root = ReactDOM.createRoot(container);
    root.render(<App />);

</script>
</body>
</html>
